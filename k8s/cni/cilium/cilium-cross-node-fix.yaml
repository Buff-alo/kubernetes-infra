# cilium-cross-node-fix.yaml
global:
  cluster:
    name: "kls-multicloud"
    id: 1

k3s:
  enabled: true

# Tunnel mode for cross-node pod networking
routing-mode: "tunnel"
tunnel-protocol: "vxlan"

# Remove device specification for tunnel mode
devices: ""

# K8s API via Tailscale
k8sServiceHost: "100.118.120.5"
k8sServicePort: 6443

# Critical: Ensure pod CIDR is properly configured
ipam:
  mode: kubernetes

# Enable and configure VXLAN properly
enable-ipv4: true
enable-ipv6: false

# MTU configuration for VXLAN over Tailscale
mtu: 1450  # Account for VXLAN + Tailscale overhead

# Hubble configuration
hubble:
  enabled: true
  tls:
    enabled: false
  relay:
    enabled: true
    insecure: true
  ui:
    enabled: true

# Security
securityContext:
  privileged: true

# Ensure proper network policy enforcement
policy:
  enabled: true
