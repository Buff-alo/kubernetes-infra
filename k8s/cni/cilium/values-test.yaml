# cilium values.yaml for K3s with Tailscale networking - Fixed for v1.16
---
# ────────────────────────────────────────────────────────────────
# GLOBAL & CLUSTER IDENTIFIERS
# ────────────────────────────────────────────────────────────────
global:
  cluster:
    name: "kls-multicloud"
    id: 1
  image:
    registry: "quay.io/cilium"
    tag: "v1.16.3"

# ────────────────────────────────────────────────────────────────
# CNI & KUBE-PROXY
# ────────────────────────────────────────────────────────────────
cni:
  chainingMode: "nil"
  exclusive: true
  customConf: true

kubeProxyReplacement: true
enableIPv4Masquerade: true
enableHostReachableServices: true
enableRuntimeDeviceDetection: true

# ────────────────────────────────────────────────────────────────
# KUBE-API ACCESS (via Tailscale)
# ────────────────────────────────────────────────────────────────
k8sServiceHost: "100.118.120.5"
k8sServicePort: 6443

# ────────────────────────────────────────────────────────────────
# NETWORKING: Fixed for Cilium 1.16+
# ────────────────────────────────────────────────────────────────
ipv4:
  enabled: true
ipv6:
  enabled: false

# Critical fix: Remove egressMasqueradeInterfaces and only use devices
devices: "enp0s6"  # Only specify the interface you want masquerading on
autoDirectNodeRoutes: false
routingMode: tunnel
tunnelProtocol: vxlan

# ────────────────────────────────────────────────────────────────
# IPAM & POD NETWORK
# ────────────────────────────────────────────────────────────────
ipam:
  mode: "kubernetes"

cluster:
  pool:
    ipv4:
      cidr: "10.42.0.0/16"

# ────────────────────────────────────────────────────────────────
# NODE INIT
# ────────────────────────────────────────────────────────────────
nodeInit:
  enabled: true

# ────────────────────────────────────────────────────────────────
# AGENT & PERFORMANCE
# ────────────────────────────────────────────────────────────────
bpf:
  masquerade: true
  hostLegacyRouting: true

resources:
  requests:
    cpu: "150m"
    memory: "192Mi"
  limits:
    cpu: "400m"
    memory: "384Mi"

# ────────────────────────────────────────────────────────────────
# HUBBLE: Temporarily disabled
# ────────────────────────────────────────────────────────────────
hubble:
  enabled: false
  relay:
    enabled: false
  ui:
    enabled: false

# ────────────────────────────────────────────────────────────────
# PROMETHEUS: Temporarily disabled
# ────────────────────────────────────────────────────────────────
prometheus:
  enabled: false

operator:
  prometheus:
    enabled: false
  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "200m"
      memory: "128Mi"

# ────────────────────────────────────────────────────────────────
# SAFETY & COMPATIBILITY
# ────────────────────────────────────────────────────────────────
rollOutCiliumPods: true
upgradeCompatibility: "1.15"

enableBandwidthManager: false
enableHostReachableServices: true
